<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="js/res/paper-core.min.js"></script>
    </head>
    <body>
        <canvas id="test" width="800px" height="800px" >
            
        </canvas>
        <script type="text/javascript">
        
            var testSrc = "AA027414.png";
            
            paper.install(window);
            
            var CanvasTools = {};
                
            paper.setup('test');

            CanvasTools.addElem = function ( src ) {
                
                var raster = new Raster({
                    source: src,
                    position: view.center
                });
                
                raster.scale(0.2);
                raster.rotate(90);
            };
            
            CanvasTools.MouseTools = function () {
                
                var hitOptions = {
                    	segments: true,
                    	stroke: true,
                    	fill: true,
                    	tolerance: 5
                    };
                var segment, path;
                var movePath = false;
                	
                var OnMouseDown = function ( event ) {
                    
                    
                    	var hitResult = project.hitTest(event.point, hitOptions);
                    	
                    	if (!hitResult) {
                    		return;
                    	}
                	
                    	if (event.modifiers.shift) {
                    		if (hitResult.type == 'segment') {
                    			hitResult.segment.remove();
                    		};
                    		return;
                    	}
                
                    	if (hitResult) {
                    		path = hitResult.item;
                    		if (hitResult.type == 'segment') {
                    		    
                    			segment = hitResult.segment;
                    			
                    		} else if (hitResult.type == 'stroke') {
                    		    
                    			var location = hitResult.location;
                    			segment = path.insert(location.index + 1, event.point);
                    			path.smooth();
                    			
                    		}
                    	}
                	
                	movePath = hitResult.type == 'fill';
                	
                	if (movePath) {
                	
                		project.activeLayer.addChild(hitResult.item);
                		
                	}
                		
                };
                
                var onMouseMove = function (event) {
                    
                	project.activeLayer.selected = false;
                	
                	if ( event.item ) {
                	    
                		event.item.selected = true;
                		
                	}	
                };
                
                var onMouseDrag = function (event) {
                    
                	if ( segment ) {
                	    
                		segment.point += event.delta;
                		path.smooth();
                		
                	} else if ( path ) {
                	    
                		path.position += event.delta;
                		
                	}
                	
                };
            };
            
            CanvasTools.addElem(testSrc);
        </script>
    </body>
</html>